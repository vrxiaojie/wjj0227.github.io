---
title: 2021-07-24-小米8刷入Win11
tags: text
renderNumberedHeading: true
grammar_cjkRuby: true
---

# 一、准备工作  
## （一）各种下载   
### 1、PE镜像：[pe 密码1234](https://pan.adycloud.com/s/aOWuO){:target="_blank"}    
### 2、dism++：[dism++](http://www.chuyu.me/zh-Hans/index.html){:target="_blank"}      
### 3、SDM845驱动：[SDM845驱动]需要clone下来并根据github页面的命令解得output文件
(https://github.com/edk2-porting/WOA-Drivers){:target="_blank"}       
### 4、win11 arm64 iso:[UUP Dump](https://uupdump.net/?lang=zh-cn){:target="_blank"}      
### 5、UEFI：[uefi](https://github.com/edk2-porting/edk2-sdm845/releases){:target="_blank"}      
### 6、parted  ：[parted](https://wwa.lanzoui.com/izy3qrsd8ab){:target="_blank"}  
### 7、一键TWRP（wzsx150制作）：[TWRP](https://wwa.lanzoui.com/icFdWrsd98f){:target="_blank"}  
## （二）软件及硬件  
### 1、最重要！ 小米8  64G 安卓10（需要最新的开发版）
### 2、usb hub 来连接多个usb设备   
### 3、电脑要安装adb和git（设置环境变量）  
## （三）需要复制到U盘的文件：  
###pe镜像、dism++、驱动解压后的output文件夹、win镜像


----------
# 二、刷入TWRP+boot签名+复制文件
### 1、手机进入fastboot，连接电脑，使用一键刷入bat文件  
### 2、进入twrp后，高级--签名boot （防止重启掉rec）
### 3、将parted 文件复制到手机内部存储


----------

# 三、分区  
### 1、分区（仅限64G 小米8） 
手机进入TWRP，电脑进入adb shell
以下内容一行一行地复制
``` 
cp /sdcard/parted /sbin/ && chmod 755 /sbin/parted
umount /data && umount /sdcard
parted /dev/block/sda
rm 21 #21是userdata分区号
mkpart esp fat32 1611MB 2100MB
mkpart pe fat32 2100MB 5100MB
mkpart win ntfs 5100MB 35GB   #实测win系统会占用24GB
mkpart userdata ext4 35GB 59GB  
set 21 esp on  #设置21分区为esp分区
```
### 2、重启TWRP，电脑再次进入adb shell。格式化分区

``` 
mkfs.fat -F32 -s1 /dev/block/by-name/pe
mkfs.fat -F32 -s1 /dev/block/by-name/esp
mkfs.ntfs -f /dev/block/by-name/win
mke2fs -t ext4 /dev/block/by-name/userdata
```
### 3、挂载PE分区到 /mnt

``` 
mount /dev/block/by-name/pe /mnt
```
### 4、OTG连接U盘，挂载USB-OTG，复制pe文件到PE分区

``` 
cp -r /usb-otg/20h2pe_new/* /mnt
```
### 5、使用TWRP直接重启进入fastboot！一定不要进安卓


----------

# 四、安装win11
## 1、boot uefi
``` 
fastboot boot boot-dipper.img
```
## 2、进入PE系统  
挂载ESP分区：  

``` 
diskpart
select disk 0
list part
select part 21 //21为你的esp分区号
assign letter=Y
exit
```
## 3、安装win11
### ①打开dism++，文件--释放镜像到某盘（空间最大的那个） **勾选 添加引导！！**  
### ②等待释放完成，打开会话--驱动管理--添加驱动--选中在驱动目录下的output目录  

## 4、关闭驱动签名（复制并保存为txt文件到U盘）

``` 
bcdedit /store Y:\efi\microsoft\boot\bcd /set {Default} testsigning on
bcdedit /store Y:\efi\microsoft\boot\bcd /set {Default} nointegritychecks on
```
## 5、重启，再次boot uefi，进入到win11系统
